# yaml-language-server: $schema=https://raw.githubusercontent.com/kyverno/chainsaw/main/.schemas/json/test-chainsaw-v1alpha1.json
apiVersion: chainsaw.kyverno.io/v1alpha1
kind: Test
metadata:
  creationTimestamp: null
  name: cel-validations-test
spec:
  steps:
  - name: step-00
    try:
    - apply:
        file: 00-install-priority-class.yaml
        expect:
         - check:
            ($error != null): true
            ($error): |-
                OpenTelemetryCollector.opentelemetry.io "sidecar-priorityclass" is invalid: spec: Invalid value: "object": the OpenTelemetry Collector mode is set to sidecar, which does not support the attribute 'priorityClassName'
  - name: step-01
    try:
    - apply:
        file: 01-install-tolerations.yaml
        expect:
         - check:
            ($error != null): true
            ($error): |-
                OpenTelemetryCollector.opentelemetry.io "sidecar-tolerations" is invalid: spec: Invalid value: "object": the OpenTelemetry Collector mode is set to sidecar, which does not support the attribute 'tolerations'
  - name: step-02
    try:
    - apply:
        file: 02-install-affinity.yaml
        expect:
         - check:
            ($error != null): true
            ($error): |-
                  OpenTelemetryCollector.opentelemetry.io "sidecar-affinity" is invalid: spec: Invalid value: "object": the OpenTelemetry Collector mode is set to sidecar, which does not support the attribute 'affinity'
  - name: step-03
    try:
    - apply:
        file: 03-install-additional-containers.yaml
        expect:
         - check:
            ($error != null): true
            ($error): |-
                  OpenTelemetryCollector.opentelemetry.io "sidecar-additional-containers" is invalid: spec: Invalid value: "object": the OpenTelemetry Collector mode is set to sidecar, which does not support the attribute 'additionalContainers'
