# yaml-language-server: $schema=https://raw.githubusercontent.com/kyverno/chainsaw/main/.schemas/json/test-chainsaw-v1alpha1.json
apiVersion: chainsaw.kyverno.io/v1alpha1
kind: Test
metadata:
  creationTimestamp: null
  name: statefulset-features
spec:
  steps:
  - name: step-00
    try:
    - script:
        content: kubectl apply -f 00-install-priority-class.yaml
        check:
          ($error != null): true
          ($stderr): >
            The OpenTelemetryCollector "otel" is invalid: spec: Invalid value: "object": the OpenTelemetry Collector mode is set to sidecar, which does not support the attribute 'priorityClassName'
  - name: step-01
    try:
    - script:
        content: kubectl apply -f 01-install-tolerations.yaml
        check:
          ($error != null): true
          ($stderr): >
            The OpenTelemetryCollector "otel" is invalid: spec: Invalid value: "object": the OpenTelemetry Collector mode is set to sidecar, which does not support the attribute 'tolerations'
  - name: step-02
    try:
    - script:
        content: kubectl apply -f 02-install-affinity.yaml
        check:
          ($error != null): true
          ($stderr): >
            The OpenTelemetryCollector "otel" is invalid: spec: Invalid value: "object": the OpenTelemetry Collector mode is set to sidecar, which does not support the attribute 'affinity'
  - name: step-03
    try:
    - script:
        content: kubectl apply -f 03-install-additional-containers.yaml
        check:
          ($error != null): true
          ($stderr): >
            The OpenTelemetryCollector "otel" is invalid: spec: Invalid value: "object": the OpenTelemetry Collector mode is set to sidecar, which does not support the attribute 'additionalContainers'
